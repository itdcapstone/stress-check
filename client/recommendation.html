<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <!-- Add FontAwesome to support stressor_mapping icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- CSS Files -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='client_styles/recommendation.css') }}">

    <title>Stress Prediction Result</title>
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>

<title>Recommendation</title>
<body>
    <!-- SIDEBAR -->
    <section id="sidebar">
        <a href="#" class="brand">
            <i class='bx bx-badge-check'></i>
            <span class="text">Stress Check</span>
        </a>
        <ul class="side-menu top">
            <li>
                <a href="{{ url_for('dashboard', username=username) }}">
                    <i class='bx bxs-dashboard' ></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li><a href="{{ url_for('analytics') }}"><i class='bx bxs-doughnut-chart'></i><span class="text">History</span></a></li>
            <li class="active"><a href="{{ url_for('recommendation') }}"><i class='bx bxs-message-rounded-dots'></i><span class="text">Recommendation</span></a></li>
            <li><a href="{{ url_for('profile') }}"><i class='bx bxs-user-circle'></i><span class="text">My Profile</span></a></li>
            <li>
                <a href="{{ url_for('faqs') }}">
                    <i class='bx bx-question-mark'></i>
                    <span class="text">FAQ's</span>
                </a>
            </li>
        </ul>
        <ul class="side-menu">
            <li><a href="{{ url_for('feedback') }}"><i class='bx bxs-user-pin'></i><span class="text">Feedback</span></a></li>
            <li><a href="{{ url_for('logout') }}" class="logout"><i class='bx bxs-log-out-circle'></i><span class="text">Logout</span></a></li>
        </ul>
        <img src="{{ url_for('static', filename='assets/plants.png') }}" alt="Image Description">
    </section>

    <!-- CONTENT -->
    <section id="content">
        <nav>
            <i class='bx bx-menu'></i>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Search...">
                    <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
                </div>
            </form>
            <input type="checkbox" id="switch-mode" hidden>
            <label for="switch-mode" class="switch-mode"></label>
        </nav>

        <!-- Result Container -->
        <div class="result-container">
            <h1>Stress Prediction Result</h1>
            <p>Hello, {{ username }}! Based on your responses, your predicted stress level is:</p>

            <!-- Circular Progress Indicator -->
            <div class="progress-container">
                <svg viewBox="0 0 200 200" width="200" height="200">
                    <circle class="progress-background" cx="100" cy="100" r="90" stroke-width="12" />
                    <circle class="progress-circle" cx="100" cy="100" r="90" stroke-width="12" stroke-dasharray="565.48" />
                </svg>
                <div class="progress-text">
                    <h2 id="progress-number">{{ predicted_stress_level }}</h2>
                    <p>Stress Level / 5</p>
                </div>
            </div>

            <!-- Stressors Section -->
            <h2>Common Stressors</h2>
            <p class="click-instruction">Click on any stressor to view personalized recommendations.</p>
            {% if common_stressors %}
            <div class="stressors-container">
                {% for stressor in common_stressors %}
                <div class="stressor-item {{ stressor.class }}" 
                    data-stressor="{{ stressor.name }}" 
                    data-recommendations="{{ stressor.recommendations | tojson | safe }}">
                    <i class="{{ stressor.icon }}"></i> 
                    <span class="stressor-name">{{ stressor.name }}</span>
                    <div class="recommendation-preview">{{ stressor.recommendations[0].text }}</div>
                </div>


                {% endfor %}
            </div>
            {% else %}
                <p>No significant stressors identified.</p>
            {% endif %}

            <!-- Modal for Detailed Recommendations -->
            <div id="recommendationModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2 id="modal-stressor-name"></h2>
                    <ul id="modal-recommendations"></ul>
                    <span class="source-icon" tabindex="0">
                        <i class='bx bx-info-circle'></i>
                        <div class="source-tooltip">Source not available</div>
                    </span>
                </div>
            </div>
            
            <!-- Generate Stress Assessment Button -->
            <form action="{{ url_for('result') }}" method="GET">
                <button type="submit" class="assessment-btn">Generate Stress Assessment</button>
            </form>
        </div>

        <script src="{{ url_for('static', filename='user_scripts/recommendation.js') }}"></script>
        <script src="{{ url_for('static', filename='script.js') }}"></script>
    </section>
</body>
</html>
