<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- My CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='admin/styles.css') }}">

	<title>AdminHub</title>
</head>
<body>

	<!-- SIDEBAR -->
	<section id="sidebar">
		<nav>
		<a href="#" class="brand">
			<i class='bx bxs-smile'></i>
			<span class="text">Stress Check</span>
		</a>
		<ul class="side-menu top">
			<li >
				<a href="{{ url_for('admin_dashboard') }}">
					<i class='bx bxs-dashboard' ></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('management') }}">
					<i class='bx bxs-shopping-bag-alt' ></i>
					<span class="text">User Management</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('data') }}">
					<i class='bx bxs-data'></i>
					<span class="text">Data Management</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('stress_questions') }}">
					<i class='bx bxs-message-square-edit'></i>
					<span class="text">Questionnaire Management</span>
				</a>
			</li>
			<li class="active">
				<a href="{{ url_for('admin_feedback') }}">
					<i class='bx bxs-user-pin'></i>
					<span class="text">User Feedback</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
			</li>
			<li>
				<a href="{{ url_for('login') }}" class="logout">
					<i class='bx bxs-log-out-circle' ></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
		</nav>
	</section>
	<!-- SIDEBAR -->

	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class="bx bx-menu"></i>
			<form action="#">
			  
		  </nav>
		<!-- NAVBAR -->


	<!-- MAIN -->
	<main>
		<div class="head-title">
			<div class="left">
				<h1>User Feedbacks</h1>
				<ul class="breadcrumb">
					<li>
						<a href="#">Dashboard</a>
					</li>
					<li><i class='bx bx-chevron-right'></i></li>
					<li>
						<a class="active" href="#">User Feedback</a>
					</li>
				</ul>
			</div>
		</div>
	
		<div class="table-container">
			<table class="feedback-table">
				<thead>
					<tr>
						<th>Username</th>
						<th>Feedback</th>
						<th>Date</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for feedback in feedback_data %}
					<tr id="feedback-row-{{ feedback._id }}">
						<td>{{ feedback.username }}</td>
						<td>{{ feedback.feedback }}</td>
						<td>{{ feedback.timestamp }}</td>
						<td>
							<button class="btn-icon view-feedback" title="View" data-feedback="{{ feedback.feedback }}" data-username="{{ feedback.username }}" data-date="{{ feedback.timestamp }}">
								<i class='bx bx-show'></i>
							</button>
							<button class="btn-icon delete-feedback" title="Delete" data-id="{{ feedback._id }}">
								<i class='bx bx-trash'></i>
							</button>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</main>
	<!-- MAIN -->
</section>
<!-- CONTENT -->

<!-- Modal for Viewing Feedback -->
<div id="viewModal" class="modal">
	<div class="modal-content">
		<span class="close-button" onclick="closeModal()">&times;</span>
		<h2>Feedback Details</h2>
		<p><strong>Username:</strong> <span id="modalUsername"></span></p>
		<p><strong>Date:</strong> <span id="modalDate"></span></p>
		<p><strong>Feedback:</strong></p>
		<p id="modalFeedback"></p>
	</div>
</div>
	</main>
	<!-- MAIN -->
</section>
	<!-- CONTENT -->

	<script>

		// Function to open and populate the modal
function openModal(username, date, feedback) {
    document.getElementById('modalUsername').innerText = username;
    document.getElementById('modalDate').innerText = date;
    document.getElementById('modalFeedback').innerText = feedback;
    document.getElementById('viewModal').style.display = 'block';
}

// Function to close the modal
function closeModal() {
    document.getElementById('viewModal').style.display = 'none';
}

// Event listener for view buttons
document.addEventListener('DOMContentLoaded', function() {
    const viewButtons = document.querySelectorAll('.view-feedback');
    viewButtons.forEach(button => {
        button.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            const date = this.getAttribute('data-date');
            const feedback = this.getAttribute('data-feedback');
            openModal(username, date, feedback);
        });
    });
});

// Close modal if clicked outside
window.onclick = function(event) {
    const modal = document.getElementById('viewModal');
    if (event.target === modal) {
        closeModal();
    }
}

		// Function to handle feedback deletion
function deleteFeedback(feedbackId) {
    if (confirm("Are you sure you want to delete this feedback?")) {
        fetch('/admin/feedback/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ feedback_id: feedbackId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert(data.message);
                // Remove the feedback row from the table
                document.getElementById(`feedback-row-${feedbackId}`).remove();
            } else {
                alert("Error: " + data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    }
}

// Event listener for delete button
document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('.delete-feedback');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const feedbackId = this.getAttribute('data-id');
            deleteFeedback(feedbackId);
        });
    });
});

	</script>
	

	<script src="{{ url_for('static', filename='script.js') }}"></script>

	<style>
		/* Modal styling */
		.modal {
			display: none;
			position: fixed;
			z-index: 1;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgba(0,0,0,0.4);
			padding-top: 60px;
		}

		.modal-content {
			background-color: #fefefe;
			margin: 5% auto;
			padding: 20px;
			border: 1px solid #888;
			width: 80%;
			max-width: 500px;
			text-align: left;
			position: relative;
		}

		.close-button {
			position: absolute;
			top: 10px;
			right: 15px;
			color: #aaa;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
		}

		.close-button:hover,
		.close-button:focus {
			color: black;
			text-decoration: none;
			cursor: pointer;
		}
	</style>

</body>
</html>