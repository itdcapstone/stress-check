<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- My CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='admin/styles.css') }}">

	<title>AdminHub</title>
</head>
<body>

	<!-- SIDEBAR -->
	<section id="sidebar">
		<nav>
		<a href="#" class="brand">
			<i class='bx bxs-smile'></i>
			<span class="text">Stress Check</span>
		</a>
		<ul class="side-menu top">
			<li>
				<a href="{{ url_for('admin_dashboard') }}">
					<i class='bx bxs-dashboard' ></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('management') }}">
					<i class='bx bxs-shopping-bag-alt' ></i>
					<span class="text">User Management</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('data') }}">
					<i class='bx bxs-data'></i>
					<span class="text">Data Management</span>
				</a>
			</li>
			<li class="active">
				<a href="{{ url_for('stress_questions') }}">
					<i class='bx bxs-message-square-edit'></i>
					<span class="text">Questionnaire Management</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('admin_feedback') }}">
					<i class='bx bxs-user-pin'></i>
					<span class="text">User Feedback</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
			</li>
			<li>
				<a href="{{ url_for('login') }}" class="logout">
					<i class='bx bxs-log-out-circle' ></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
		</nav>
	</section>
	<!-- SIDEBAR -->

	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class="bx bx-menu"></i>
			<form action="#">
			  
		  </nav>
		<!-- NAVBAR -->


	<!-- MAIN -->
	<main>
		<div class="head-title">
			<div class="left">
				<h1>Manage Questionnaire Content</h1>
				<ul class="breadcrumb">
					<li>
						<a href="#">Dashboard</a>
					</li>
					<li><i class='bx bx-chevron-right'></i></li>
					<li>
						<a class="active" href="#">Questionnaire</a>
					</li>
				</ul>
			</div>
		</div>
	
		<div class="questionnaire-management-header">
			<h2></h2>
			<a href="{{ url_for('add_question') }}" class="btn-add-question">Add New Question</a>
		</div>

		<form id="deleteForm" action="{{ url_for('stress_questions') }}" method="POST">
			<input type="hidden" name="question_id" id="deleteQuestionId">
			<input type="hidden" name="delete_question" value="1">
		</form>	
	
		<table class="questionnaire-table">
			<thead>
				<tr>
					<th>Question</th>
					<th>Type</th>
					<th>Category</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{% for question in stress_questions %}
				<tr>
					<td>{{ question['question'] }}</td>
					<td>{{ question['type'] }}</td>
					<td>{{ question['category'] }}</td>
					<td>
						<button type="button" class="btn-icon delete" 
								onclick="confirmDelete('{{ question._id }}', '{{ question._id }}')">
							<i class='bx bx-trash'></i>
						</button>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</main>
	<!-- MAIN -->
</section>
	<!-- CONTENT -->
	 <script>
		document.addEventListener('DOMContentLoaded', function () {
    // Attach click event listeners to delete buttons
    document.querySelectorAll('.delete').forEach(function (button) {
        button.addEventListener('click', function () {
            const questionId = button.getAttribute('data-id');
            if (confirm("Are you sure you want to delete this question?")) {
                deleteQuestion(questionId, button.closest('tr'));
            }
        });
    });
});

// Function to send the delete request via AJAX
function deleteQuestion(questionId, rowElement) {
    console.log('Sending delete request for question ID:', questionId);  // Log the question ID being sent

    fetch('/admin/stress_questions', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            delete_question: 1,
            question_id: questionId
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Response from server:', data);  // Log the server's response
        if (data.status === 'success') {
            alert(data.message);
            rowElement.remove();  // Remove the row from the table
        } else {
            alert("Error: " + data.message);
        }
    })
    .catch(error => {
        console.error('Error deleting question:', error);
        alert('Error deleting question');
    });
}
	 </script>
	
	<script src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>